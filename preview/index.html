<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Remote SLD Styling</title>
    <link rel="stylesheet" href="openlayers/theme/default/style.css" type="text/css">
    <link rel="stylesheet" href="style.css" type="text/css">
    <style>
        .smallmap {
            border: 1px solid #CCCCCC;
            height: 512px;
            width: 1024px;
        }
    </style>
    <script src="openlayers/OpenLayers.js"></script>
    <script type="text/javascript">
        var vmap, layer, layertostyle;
        var sld_base_dir = "http://s1.pozi.com/vic_styles/sld/";
        var wms_endpoint = "http://services.land.vic.gov.au/catalogue/httpproxy/sdm_geoserver/wms";
        function init(){

                document.getElementById("wms_endpoint").value = window.location.hash.split("#")[1];
                document.getElementById("layer_to_style").value = window.location.hash.split("#")[2];
                document.getElementById("srs").value = window.location.hash.split("#")[3];
                document.getElementById("sld_location").value = window.location.hash.split("#")[4];
                document.getElementById("sld_base_directory").innerHTML = sld_base_dir;
                
                vmap = new OpenLayers.Map('map',
                    {
                        projection: "EPSG:900913",
                        units: "m",
                        maxResolution: 156543.0339,
                        maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34, 20037508.34, 20037508.34),
                        controls:[
                            new OpenLayers.Control.Navigation(),
                            new OpenLayers.Control.Zoom(),
                            new OpenLayers.Control.ScaleLine(),
                            new OpenLayers.Control.Scale(),
                            new OpenLayers.Control.LayerSwitcher(),
                            new OpenLayers.Control.ZoomBox({'keyMask': OpenLayers.Handler.MOD_SHIFT})
                        ],
                        numZoomLevels:20,
                        theme: null
                    }
                );

                baselayer = new OpenLayers.Layer.WMS( "Vicmap Classic",
                    "http://basemap.pozi.com/geoserver/ows",
                    {layers: 'VicmapClassic'},
                    {opacity: 1} 
                );
                vmap.addLayer(baselayer);

                refreshWMS();

                vmap.setCenter(
                    new OpenLayers.LonLat(145, -38).transform(
                        new OpenLayers.Projection("EPSG:4326"),
                        vmap.getProjectionObject()
                    ), 12
                );

        }

        function refreshWMS(){

                window.location.hash = [
                    "",
                    document.getElementById("wms_endpoint").value,
                    document.getElementById("layer_to_style").value,
                    document.getElementById("srs").value,
                    document.getElementById("sld_location").value
                ].join("#")

                var layerToRemove = vmap.getLayersByName("Layer to style");
                if (layerToRemove.length)
                {
                    // By construction, there is only one WMS layer with this name
                    vmap.removeLayer(layerToRemove[0]);
                }

                // Taking into account current values from the page
                var lts = document.getElementById("layer_to_style");
                if (lts.value)
                {

                    layertostyle = new OpenLayers.Layer.WMS( "Layer to style",
                        document.getElementById("wms_endpoint").value,
                        {
                            layers: lts.value,
                            format:"image/png8",
                            transparent: true,
                            srs: document.getElementById("srs").value,
                            sld: sld_base_dir + document.getElementById("sld_location").value
                        },
                        {
                            isBaseLayer: false,
                            singleTile: true
                        }
                    );

                    vmap.addLayer(layertostyle);

                }

        }
    </script>
  </head>
  <body onload="init()">
    <p> 
        WMS_ENDPOINT=<input type="text" name="wms_endpoint" id="wms_endpoint" size=35 value="" />
        LAYER=<input type="text" name="layer_to_style" id="layer_to_style" size=65 value="" />
        SRS=<input type="text" name="srs" id="srs" size=10 value="" /> <br/>
        SLD=<span id="sld_base_directory"></span><input type="text" name="sld_location" id="sld_location" size=80 value="" />
        <button onclick="refreshWMS()">Apply</button>
    </p>
    <div id="map" class="smallmap"></div>
  </body>
</html>